<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Blog Post</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div id="post-content">Loading...</div>

  <script>
     async function fetchPost(slug) {
        const query = encodeURIComponent(`*[_type == "journalPost" && slug.current == "${slug}"][0]{
            title,
            publishedAt,
            body,
            "imageUrl": mainImage.asset->url
        }`);

        const url = 'https://fbog0kgj.api.sanity.io/v2021-10-21/data/query/production?query=${query}';

        const response = await fetch(url);
        const result = await response.json();
        return result.result;
     }

     function getSlugFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('slug');
     }

     function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric"
        });
     }

     async function renderPost() {
        const slug = getSlugFromURL();
        const container = document.getElementById("post-content");

        if (!slug) {
            container.innerHTML = "<p>Error: No slug found in URL.</p>";
            return;
        }

        const post = await fetchPost(slug);

        if (!post) {
            container.innerHTML = '<p>No post found for slug: "${slug}".</p>';
            return;
        }

        container.innerHTML =
            <h1>${post.title}</h1>
            <p class="date">${post.publishedAt ? formatDate(post.publishedAt) : "No date"}</p>
            ${post.imageUrl ? '<img src=${post.imageUrl}" alt="${post.title}" />' : ""}
            <div class="post-body">${post.body}</div>
        ';
     }

     document.addEventListener("DOMContentLoaded", renderPost);
  </script>
</body>
</html>
